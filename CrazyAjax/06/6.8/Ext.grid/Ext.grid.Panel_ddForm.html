<!DOCTYPE html>
<html>
<head>
	<meta name="author" content="Yeeku.H.Lee(CrazyIt.org)" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title> 拖放表格数据 </title>
	<!-- 导入Ext JS必需的CSS样式单 -->
	<link href="extjs/resources/css/ext-all.css" rel="stylesheet" type="text/css" />
	<!-- 导入Ext JS必需的JavaScript库 -->
	<script type="text/javascript" src="extjs/ext-all.js">
	</script>
	<!-- 导入Ext JS国际化所需的JavaScript库 -->
	<script type="text/javascript" src="extjs/ext-lang-zh_CN.js">
	</script>
</head>
<body>
<script type="text/javascript">
Ext.onReady(function(){
	// 定义本地数据
	var data = {
		users: [
			{id: 1, name: '孙悟空', email: 'sun@tian.com'},
			{id: 2, name: '猪八戒', email: 'zhu@tian.com'},
			{id: 3, name: '白骨精', email: 'bai@tian.com'},
			{id: 4, name: '蜘蛛精', email: 'zhi@tian.com'},
			{id: 5, name: '牛魔王', email: 'niu@tian.com'}
		],
		total:5
	};
	var userStore = Ext.create('Ext.data.Store', 
	{
		// 指定Store包含的记录所包含的字段
		fields:['id' , 'name', 'email'],
		// 使用proxy指定加载本地数据
		proxy: {
			type: 'memory', // 指定使用PagingMemoryProxy控制读取内存数据
			data: data,
			reader: {
				type: 'json',
				root: 'users', // 直接读取users数据
				totalProperty: 'total' // total属性值代表了总记录条数
			}
		},
		autoLoad: true // 指定自动加载
	});
	Ext.create('Ext.panel.Panel', {
		title: '拖放',
		width: 400,
		renderTo: Ext.getBody(),
		items:[
			{
				xtype: 'gridpanel',
				store: userStore,
				width: '100%',
				columns: [
					{ header: 'ID', dataIndex: 'id' },
					{ header: '姓名', dataIndex: 'name'},
					{ header: 'Email', dataIndex: 'email' , flex: 1 }
				],
				// 对该Ext.grid.Panel内部的View进行配置
				viewConfig: {
					plugins: {
						ddGroup: 'fkGroup', // 指定它所在的拖放组
						ptype: 'gridviewdragdrop',
						dragText: '拖到表单中',
						enableDrop: false, // 指定不允许“放”
					}
				}
			},
			{
				id: 'my_form',
				xtype: 'form',
				width: '100%',
				bodyPadding: 10,
				items: [
					{
						xtype: 'textfield',
						name: 'id',
						fieldLabel: 'ID', // 指定该表单控件的标签
					}, 
					{
						xtype: 'textfield',
						name: 'name',
						fieldLabel: '人名', // 指定该表单控件的标签
					}, 
					{
						xtype: 'textfield',
						name: 'email',
						fieldLabel: 'Email', // 指定该表单控件的标签
					}
				]
			}
		]
	});
	// 创建、并执行创建“放目标”的函数
	(function(){
		var formPanel = Ext.getCmp('my_form');
		var formPanelDropTargetEl = formPanel.body.dom;

		var formPanelDropTarget = Ext.create('Ext.dd.DropTarget', formPanelDropTargetEl,
		{
			 ddGroup: 'fkGroup', // 指定它所在的拖放组，与前面的拖放组对应
			// 指定把拖放数据“拖入”目标时触发该事件处理函数
			notifyEnter: function(ddSource, e, data) 
			{
				// 设置表单Panel停止动画
				formPanel.body.stopAnimation();
				// 设置表单Panel显示高亮效果
				formPanel.body.highlight();
			},
			// 指定把拖放数据“放置到”目标时触发该事件处理函数
			notifyDrop : function(ddSource, e, data)
			{
				// 获取选中的行
				var selectedRecord = ddSource.dragData.records[0];
				// 指定表单Panel加载选中的数据行
				formPanel.getForm().loadRecord(selectedRecord);
				// 根据需要决定，是否要删除源表格中的数据
				// ddSource.view.store.remove(selectedRecord);
				return true;
			}
		});
	})();
});
</script>
</body>
</html>
