<!DOCTYPE html>
<html>
<head>
	<meta name="author" content="Yeeku.H.Lee(CrazyIt.org)" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title> 数据分组 </title>
	<!-- 导入Ext JS必需的CSS样式单 -->
	<link href="extjs/resources/css/ext-all.css" rel="stylesheet" type="text/css" />
	<!-- 导入Ext JS必需的JavaScript库 -->
	<script type="text/javascript" src="extjs/ext-all.js">
	</script>
	<!-- 导入Ext JS国际化所需的JavaScript库 -->
	<script type="text/javascript" src="extjs/ext-lang-zh_CN.js">
	</script>
</head>
<body>
<script type="text/javascript">
Ext.onReady(function(){
	Ext.define('Book', {
		extend: 'Ext.data.Model',
		fields: [
			{name: 'id' , type: 'int'},
			{name: 'name', type: 'string'},
			{name: 'author', type: 'string'},
			{name: 'price', type: 'float'},
		]
	});
	// 创建一个Ext.data.Store对象
	var bookStore = Ext.create('Ext.data.Store', 
	{
		// 指定使用Book Model管理记录
		model: 'Book',
		// 指定分组列
		groupField: 'author',
		// 使用proxy指定加载远程数据
		proxy: 
		{
			type: 'ajax',
			url: 'getAllBooks',// 向该URL发送Ajax请求
			reader: { // 使用Ext.data.reader.Json读取服务器数据
				type: 'json',
				root: 'data' // 直接读取服务器响应的data数据
			},
		},
		autoLoad:true// 自动加载服务器数据
	});
	Ext.create('Ext.grid.Panel', {
		title: '查看服务器端图书',
		width: 550, // 指定表单宽度
		renderTo: Ext.getBody(),
		// 定义该表格包含的所有数据列
		columns: [
			{ text: '图书ID', dataIndex: 'id' , flex: 1 }, // 第1个数据列
			{ text: '书名', dataIndex: 'name' , flex: 1 }, // 第2个数据列
			{ text: '作者', dataIndex: 'author', flex: 1 }, // 第3个数据列
			{ text: '价格', dataIndex: 'price' , flex: 1 }, // 第4个数据列
			{ text: '统计图书' , dataIndex: 'name', summaryType: 'count',
				summaryRenderer: function(value){
					return Ext.String.format('<b>总共：{0}本图书</b>', value);
				}
			}
		],
		features:[
			// 通过features选项启用分组特性
			{
				ftype: 'groupingsummary',
				groupHeaderTpl: '{name}的图书'
			},
			// 通过features选项启用rowbody特性
			{
				ftype: 'rowbody',
				getAdditionalData: function(data, rowIndex, record, orig)
				{
					var headerCt = this.view.headerCt,
					colspan = headerCt.getColumnCount();
					return {
						rowBody: '<div style="background:#ccc;">这是' 
							+ record.get("author")+'的图书。</div>',
						rowBodyColspan: colspan
					};
				}
			}
		],
		store: bookStore
	});
});
</script>
</body>
</html>
