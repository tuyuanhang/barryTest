<!DOCTYPE html>
<html>
<head>
	<meta name="author" content="Yeeku.H.Lee(CrazyIt.org)" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title> 二级联动 </title>
	<!-- 导入Ext JS必需的CSS样式单 -->
	<link href="extjs/resources/css/ext-all.css" rel="stylesheet" type="text/css" />
	<!-- 导入Ext JS必需的JavaScript库 -->
	<script type="text/javascript" src="extjs/ext-all.js">
	</script>
	<!-- 导入Ext JS国际化所需的JavaScript库 -->
	<script type="text/javascript" src="extjs/ext-lang-zh_CN.js">
	</script>
</head>
<body>
<script type="text/javascript">
Ext.onReady(function(){
	// 创建一个Ext.data.Store对象
	var categoryStore = Ext.create('Ext.data.Store', 
	{
		// 指定读取数据的name、id字段
		fields: ['name' , 'id'],
		proxy: 
		{
			type: 'ajax',
			url: 'getAllCategorys',// 向该URL发送Ajax请求
			reader: { // 使用Ext.data.reader.Json读取服务器数据
				type: 'json',
				root: 'data' // 直接读取服务器响应的data数据
			},
		},
		autoLoad: true
	});
	// 创建一个Ext.data.Store对象
	var bookStore = Ext.create('Ext.data.Store', 
	{
		// 指定读取数据的name、id字段
		fields: ['name' , 'id'],
		proxy: 
		{
			type: 'ajax',
			url: 'getBooksByCategory',// 向该URL发送Ajax请求
			reader: { // 使用Ext.data.reader.Json读取服务器数据
				type: 'json',
				root: 'data' // 直接读取服务器响应的data数据
			},
		},
	});
	Ext.create('Ext.form.Panel', {
		title: '选择图书',
		bodyPadding: 5,
		width: 350, // 指定表单宽度
		// 默认使用anchor布局方式
		layout: 'anchor',
		renderTo: Ext.getBody(),
		// 设置表单控件默认占满整个容器
		defaults: {
			anchor: '100%'
		},
		items:[
			{
				id: 'catgory_combo',
				xtype: 'combobox',
				fieldLabel: '选择种类',
				width: 300,
				store: categoryStore, // 使用categoryStore数据提供下拉列表项的数据
				displayField: 'name', // 列表项的显示文本使用name字段的值。
				valueField: 'id', // 列表项的值使用id字段的值。
				queryMode: 'local', // 指定使用Store中已有数据
				listeners: {
					select: function(combo, ecords)
					{
						Ext.getCmp('book_combo').reset();
						// 调用bookStore的load()方法加载服务器响应
						bookStore.load({
							// 发送请求categoryId参数，该参数代表图书类别
							params: {
								categoryId: combo.value
							}
						});
					}
				}
			},
			{
				id: 'book_combo',
				xtype: 'combobox',
				fieldLabel: '选择图书',
				width: 300,
				store: bookStore, // 使用bookStore数据提供下拉列表项的数据
				displayField: 'name', // 列表项的显示文本使用name字段的值。
				valueField: 'id', // 列表项的值使用id字段的值。
				queryMode: 'local', // 指定使用Store中已有数据
			}
		]
	});
});
</script>
</body>
</html>
